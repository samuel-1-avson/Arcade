"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[30],{8079:function(e,t,r){r.d(t,{a:function(){return c}});var a=r(2265),n=r(3820),s=r(4257),i=r(4752);let u=new i.hJ,l={signInWithGoogle:async()=>{let e=await (0,s.yL)();if(!e)throw Error("Firebase Auth not initialized");try{let t=await (0,i.rh)(e,u);return o(t.user)}catch(t){if((null==t?void 0:t.code)==="auth/popup-blocked")return await (0,i.F6)(e,u),null;throw t}},signInAsGuest:async()=>{let e=await (0,s.yL)();if(!e)throw Error("Firebase Auth not initialized");return o((await (0,i.XB)(e)).user)},signOut:async()=>{let e=await (0,s.yL)();if(!e)throw Error("Firebase Auth not initialized");return(0,i.w7)(e)},updateUserProfile:async(e,t)=>{let r=await (0,s.yL)();r&&r.currentUser&&await (0,i.ck)(r.currentUser,{displayName:e,photoURL:t})}};function o(e){return{id:e.uid,email:e.email||"",displayName:e.displayName||"Guest",avatar:e.photoURL||"/avatars/default.png",level:1,xp:0,totalScore:0,gamesPlayed:0,createdAt:new Date(e.metadata.creationTime||Date.now()),preferences:{soundEnabled:!0,musicEnabled:!0,notificationsEnabled:!0,theme:"dark"}}}function c(){let{user:e,isLoading:t,isAuthenticated:r,setUser:s,signOut:i}=(0,n.tN)(),u=(0,a.useCallback)(async()=>{try{let e=await l.signInWithGoogle();return e&&s(e),e}catch(e){throw(null==e?void 0:e.code)==="auth/popup-blocked"?alert("Please allow popups for this site to sign in with Google."):(null==e?void 0:e.code)==="auth/cancelled-popup-request"||alert("Sign-in failed. Please try again."),e}},[s]);return{user:e,isLoading:t,isAuthenticated:r,signInWithGoogle:u,signInAsGuest:(0,a.useCallback)(async()=>{try{let e=await l.signInAsGuest();return s(e),e}catch(e){throw e}},[s]),signOut:(0,a.useCallback)(async()=>{try{await l.signOut(),i()}catch(e){throw e}},[i]),updateProfile:(0,a.useCallback)(async(e,t)=>{try{await l.updateUserProfile(e,t),n.tN.getState().updateProfile({displayName:e,avatar:t})}catch(e){throw e}},[])}}},4257:function(e,t,r){r.d(t,{xI:function(){return m},yL:function(){return h}});var a=r(738),n=r(4752),s=r(5978);r(6834);let i={apiKey:"AIzaSyCumtfvMCnSRXMHtOghgLv87PdvmwD3yjA".trim(),authDomain:"arcade-7f03c.firebaseapp.com".trim(),projectId:"arcade-7f03c".trim(),storageBucket:"arcade-7f03c.firebasestorage.app".trim(),messagingSenderId:"883884342768".trim(),appId:"1:883884342768:web:8c6a43c1c3c01790d2f135".trim(),measurementId:"G-NCQBGH5RR3".trim()},u=null,l=null,o=null,c=null;async function d(){return u&&l?{app:u,auth:l,db:o}:c||(c=(async()=>{try{if(0===(0,a.C6)().length){if(!i.apiKey||"undefined"===i.apiKey)return{app:null,auth:null,db:null};u=(0,a.ZF)(i)}else u=(0,a.C6)()[0];return l=(0,n.v0)(u),await (0,n.Fb)(l,n.a$),o=(0,s.ad)(u),{app:u,auth:l,db:o}}catch(e){return{app:null,auth:null,db:null}}})())}async function h(){if(l)return l;let{auth:e}=await d();return e}async function m(){if(o)return o;let{db:e}=await d();return e}},3820:function(e,t,r){r.d(t,{tN:function(){return s},gT:function(){return i},Pl:function(){return h},ev:function(){return u}});var a=r(9625),n=r(6885);let s=(0,a.Ue)()((0,n.tJ)(e=>({user:null,isLoading:!0,isAuthenticated:!1,setUser:t=>e({user:t,isAuthenticated:!!t,isLoading:!1}),setLoading:t=>e({isLoading:t}),signOut:()=>e({user:null,isAuthenticated:!1,isLoading:!1}),updateProfile:t=>e(e=>({user:e.user?{...e.user,...t}:null})),updatePreferences:t=>e(e=>({user:e.user?{...e.user,preferences:{...e.user.preferences,...t}}:null}))}),{name:"auth-storage",partialize:e=>({user:e.user})})),i=(0,a.Ue)()(e=>({games:[],filter:"all",highScores:{},setGames:t=>e({games:t}),setFilter:t=>e({filter:t}),setHighScore:(t,r)=>e(e=>({highScores:{...e.highScores,[t]:Math.max(e.highScores[t]||0,r)}}))})),u=(0,a.Ue)()((e,t)=>({currentParty:null,isInParty:!1,messages:[],isDrawerOpen:!1,createParty:async()=>{let t=Math.random().toString(36).substring(2,8).toUpperCase();e({currentParty:{id:crypto.randomUUID(),code:t,hostId:"current-user",members:[],status:"waiting",createdAt:new Date},isInParty:!0})},joinParty:async e=>{},leaveParty:()=>{e({currentParty:null,isInParty:!1,messages:[]})},sendMessage:r=>{let{currentParty:a}=t();if(!a)return;let n={id:crypto.randomUUID(),userId:"current-user",displayName:"You",text:r,timestamp:new Date};e(e=>({messages:[...e.messages,n]}))},addMember:t=>{e(e=>({currentParty:e.currentParty?{...e.currentParty,members:[...e.currentParty.members,t]}:null}))},removeMember:t=>{e(e=>({currentParty:e.currentParty?{...e.currentParty,members:e.currentParty.members.filter(e=>e.userId!==t)}:null}))},setDrawerOpen:t=>e({isDrawerOpen:t})}));var l=r(5978),o=r(4257);let c="userStats",d={getLeaderboard:async function(e){let t,r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,n=arguments.length>2?arguments[2]:void 0,s=await (0,o.xI)();if(!s)throw Error("Firebase not initialized");let i=(0,l.hJ)(s,c);t="global"===e?n?(0,l.IO)(i,(0,l.Xo)("bestScore","desc"),(0,l.TQ)(n),(0,l.b9)(a)):(0,l.IO)(i,(0,l.Xo)("bestScore","desc"),(0,l.b9)(a)):n?(0,l.IO)(i,(0,l.ar)("gameId","==",e),(0,l.Xo)("bestScore","desc"),(0,l.TQ)(n),(0,l.b9)(a)):(0,l.IO)(i,(0,l.ar)("gameId","==",e),(0,l.Xo)("bestScore","desc"),(0,l.b9)(a));let u=await (0,l.PL)(t),d=Array.from(new Set(u.docs.map(e=>e.data().userId))),h={};for(let e=0;e<d.length;e+=10){let t=d.slice(e,e+10),r=(0,l.IO)((0,l.hJ)(s,"users"),(0,l.ar)("__name__","in",t));(await (0,l.PL)(r)).docs.forEach(e=>{let t=e.data();h[e.id]={displayName:t.displayName||"Anonymous",avatar:t.avatar||"User",photoURL:t.photoURL}})}let m=[],y=1;for(let e of u.docs){var f;let t=e.data(),a=h[t.userId]||{displayName:"Anonymous",avatar:"User"};m.push({rank:n?y+50:y,userId:t.userId,displayName:a.displayName,avatar:a.avatar,photoURL:a.photoURL,score:t.bestScore,timestamp:(null===(f=t.lastPlayed)||void 0===f?void 0:f.toDate())||new Date}),y++,r=t.bestScore}return{entries:m,lastScore:r}},getUserRank:async(e,t)=>{let r;let a=await (0,o.xI)();if(!a)throw Error("Firebase not initialized");let n=(0,l.hJ)(a,c);r="global"===t?(0,l.IO)(n,(0,l.Xo)("bestScore","desc")):(0,l.IO)(n,(0,l.ar)("gameId","==",t),(0,l.Xo)("bestScore","desc"));let s=await (0,l.PL)(r),i=1;for(let t of s.docs){if(t.data().userId===e)return i;i++}return null}},h=(0,a.Ue)()(e=>({entries:[],currentUserRank:null,selectedGame:"global",isLoading:!1,error:null,setEntries:t=>e({entries:t}),setCurrentUserRank:t=>e({currentUserRank:t}),setSelectedGame:t=>e({selectedGame:t}),setIsLoading:t=>e({isLoading:t}),fetchLeaderboard:async(t,r)=>{e({isLoading:!0,error:null});try{let a=await d.getLeaderboard(t,50);if(e({entries:a.entries,isLoading:!1}),r){let a=await d.getUserRank(r,t);e({currentUserRank:a})}}catch(t){e({error:"Failed to load leaderboard",isLoading:!1,entries:[]})}}}))},4508:function(e,t,r){r.d(t,{cn:function(){return s}});var a=r(1994),n=r(3335);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.m6)((0,a.W)(t))}}}]);