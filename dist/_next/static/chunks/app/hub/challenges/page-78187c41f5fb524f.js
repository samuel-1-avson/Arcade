(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[478],{4334:function(e,t,a){Promise.resolve().then(a.bind(a,1896))},1896:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return k}});var r=a(7437),i=a(2265),l=a(8896),s=a(1723),n=a(1239),c=a(9474),d=a(5302),o=a(4508),m=a(2869),p=a(8079),g=a(5978),u=a(4257);let x="challenges",h="userChallenges",f=()=>{let e=new Date;return e.setDate(e.getDate()+1),e.setHours(0,0,0,0),[{title:"Snake Master",description:"Score 500 points in Snake",game:"snake",target:500,reward:50,expiresAt:e,active:!0},{title:"Pac-Man Hunter",description:"Score 1000 points in Pac-Man",game:"pacman",target:1e3,reward:75,expiresAt:e,active:!0},{title:"Tetris Stacker",description:"Clear 20 lines in Tetris",game:"tetris",target:20,reward:60,expiresAt:e,active:!0}]},w=()=>{let e=new Date;return e.setDate(e.getDate()+7),e.setHours(0,0,0,0),[{title:"Weekly Warrior",description:"Play 20 games this week",game:"any",target:20,reward:200,expiresAt:e,active:!0},{title:"High Score Hero",description:"Achieve a total score of 5000 across all games",game:"any",target:5e3,reward:300,expiresAt:e,active:!0}]},y={initializeDailyChallenges:async()=>{let e=await (0,u.xI)();if(!e)return;let t=(0,g.hJ)(e,x),a=new Date;a.setHours(0,0,0,0);let r=(0,g.IO)(t,(0,g.ar)("expiresAt",">",g.EK.fromDate(a)));if(!(await (0,g.PL)(r)).empty)return;for(let e of f())await (0,g.pl)((0,g.JU)(t),{...e,type:"daily",createdAt:(0,g.Bt)()});let i=new Date().getDay(),l=!(await (0,g.PL)((0,g.IO)(t,(0,g.ar)("type","==","weekly")))).empty;if(1===i||!l)for(let e of w())await (0,g.pl)((0,g.JU)(t),{...e,type:"weekly",createdAt:(0,g.Bt)()})},getActiveChallenges:async()=>{let e=await (0,u.xI)();if(!e){let e=new Date;return e.setDate(e.getDate()+1),[{id:"daily-1",title:"Snake Master",description:"Score 500 points in Snake",game:"snake",target:500,reward:50,expiresAt:e,active:!0},{id:"weekly-1",title:"Weekly Warrior",description:"Play 20 games this week",game:"any",target:20,reward:200,expiresAt:e,active:!0}]}await y.initializeDailyChallenges();let t=(0,g.hJ)(e,x),a=g.EK.now(),r=(0,g.IO)(t,(0,g.ar)("expiresAt",">",a),(0,g.ar)("active","==",!0));return(await (0,g.PL)(r)).docs.map(e=>({id:e.id,title:e.data().title,description:e.data().description,game:e.data().game,target:e.data().target,reward:e.data().reward,expiresAt:e.data().expiresAt.toDate(),active:e.data().active}))},getUserChallenges:async e=>{let t=await (0,u.xI)();if(!t)return[];let a=(0,g.hJ)(t,h),r=(0,g.IO)(a,(0,g.ar)("userId","==",e));return(await (0,g.PL)(r)).docs.map(e=>{var t;return{challengeId:e.data().challengeId,progress:e.data().progress||0,completed:e.data().completed||!1,completedAt:null===(t=e.data().completedAt)||void 0===t?void 0:t.toDate(),claimed:e.data().claimed||!1}})},updateProgress:async(e,t,a)=>{let r=await (0,u.xI)();if(!r)return{completed:[],rewards:0};let i=[],l=0;for(let s of(await y.getActiveChallenges()).filter(e=>"any"===e.game||e.game===t)){let t=(0,g.JU)(r,h,"".concat(e,"_").concat(s.id)),n=await (0,g.QT)(t),c=n.exists()?n.data():{progress:0,completed:!1};if(c.completed)continue;let d=c.progress;"any"===s.game&&s.title.includes("Score")?d+=a:"any"===s.game&&s.title.includes("Play")?d+=1:d=Math.max(d,a);let o=d>=s.target;await (0,g.pl)(t,{userId:e,challengeId:s.id,progress:Math.min(d,s.target),completed:o,completedAt:o?(0,g.Bt)():null,claimed:!1,updatedAt:(0,g.Bt)()}),o&&!c.completed&&(i.push(s.id),l+=s.reward)}return{completed:i,rewards:l}},claimReward:async(e,t)=>{let a=await (0,u.xI)();if(!a)return!1;let r=(0,g.JU)(a,h,"".concat(e,"_").concat(t)),i=await (0,g.QT)(r);if(!i.exists())return!1;let l=i.data();return!!l.completed&&!l.claimed&&(await (0,g.r7)(r,{claimed:!0,updatedAt:(0,g.Bt)()}),!0)}};var v=a(6895);let b={Target:l.Z,Clock:s.Z,Zap:n.Z,Trophy:c.Z};function k(){let{user:e}=(0,p.a)(),[t,a]=(0,i.useState)([]),[s,n]=(0,i.useState)(!0),[c,g]=(0,i.useState)(null);(0,i.useEffect)(()=>{(async()=>{n(!0);try{let t=await y.getActiveChallenges(),r=e?await y.getUserChallenges(e.id):[],i=t.map(e=>{let t=r.find(t=>t.challengeId===e.id);return{...e,challengeId:e.id,progress:(null==t?void 0:t.progress)||0,completed:(null==t?void 0:t.completed)||!1,completedAt:null==t?void 0:t.completedAt,claimed:(null==t?void 0:t.claimed)||!1}});a(i)}catch(e){}finally{n(!1)}})()},[e]);let u=async r=>{if(e){g(r);try{if(await y.claimReward(e.id,r)){a(e=>e.map(e=>e.id===r?{...e,claimed:!0}:e));let i=t.find(e=>e.id===r);i&&await v.v.addCoins(e.id,i.reward)}}catch(e){}finally{g(null)}}},x=t.filter(e=>e.completed).length;t.filter(e=>e.claimed).length;let h=new Date,f=new Date(h);f.setDate(f.getDate()+1),f.setHours(0,0,0,0);let w=Math.floor((f.getTime()-h.getTime())/36e5),k=Math.floor((f.getTime()-h.getTime())%36e5/6e4);return s?(0,r.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,r.jsx)("h1",{className:"font-display text-2xl font-bold uppercase tracking-wider text-primary",children:"Daily Challenges"}),(0,r.jsx)("div",{className:"p-8 text-center text-muted-foreground",children:"Loading challenges..."})]}):(0,r.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"font-display text-2xl font-bold uppercase tracking-wider text-primary mb-2",children:"Daily Challenges"}),(0,r.jsx)("p",{className:"text-muted-foreground text-sm",children:e?"Complete challenges to earn bonus coins":"Sign in to participate in challenges"})]}),(0,r.jsxs)("div",{className:"bg-elevated border border-accent-border p-4 flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"Time Remaining"}),(0,r.jsxs)("p",{className:"font-display text-xl font-bold text-accent",children:[w,"h ",k,"m"]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"Completed"}),(0,r.jsxs)("p",{className:"font-display text-xl font-bold text-primary",children:[x,"/",t.length]})]})]}),(0,r.jsx)("div",{className:"space-y-4",children:0===t.length?(0,r.jsx)("div",{className:"p-8 text-center text-muted-foreground bg-elevated border border-white/[0.06]",children:"No active challenges available."}):t.map(t=>{let a=b["snake"===t.game?"Target":"pacman"===t.game?"Zap":"tetris"===t.game?"Clock":"Trophy"]||l.Z,i=Math.min(100,t.progress/t.target*100),s=t.completed&&!t.claimed;return(0,r.jsx)("div",{className:(0,o.cn)("bg-elevated border p-4 transition-colors",s?"border-warning/50 bg-warning/5":"border-white/[0.06] hover:border-white/[0.12]"),children:(0,r.jsxs)("div",{className:"flex items-start gap-4",children:[(0,r.jsx)("div",{className:(0,o.cn)("w-12 h-12 border flex items-center justify-center flex-shrink-0",t.completed?"bg-accent-dim border-accent-border":"bg-surface border-white/[0.08]"),children:t.claimed?(0,r.jsx)(d.Z,{className:"w-6 h-6 text-green-500"}):(0,r.jsx)(a,{className:(0,o.cn)("w-6 h-6",t.completed?"text-accent":"text-muted-foreground")})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-display text-sm font-bold uppercase tracking-wide text-primary",children:t.title}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:t.description})]}),(0,r.jsxs)("div",{className:"text-right flex-shrink-0",children:[(0,r.jsxs)("p",{className:"font-mono font-bold text-warning",children:["+",t.reward]}),(0,r.jsx)("p",{className:"text-[10px] text-muted-foreground",children:"coins"})]})]}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsxs)("div",{className:"flex justify-between text-xs mb-1",children:[(0,r.jsxs)("span",{className:"text-muted-foreground",children:[t.progress.toLocaleString(),"/",t.target.toLocaleString()]}),(0,r.jsxs)("span",{className:t.completed?"text-accent":"text-muted-foreground",children:[Math.round(i),"%"]})]}),(0,r.jsx)("div",{className:"h-2 bg-surface overflow-hidden",children:(0,r.jsx)("div",{className:(0,o.cn)("h-full transition-all duration-500",t.completed?"bg-accent":"bg-white/20"),style:{width:"".concat(i,"%")}})})]}),s&&e&&(0,r.jsx)(m.z,{size:"sm",className:"mt-3 w-full",onClick:()=>u(t.id),disabled:c===t.id,children:c===t.id?"Claiming...":"Claim Reward"}),t.claimed&&(0,r.jsxs)("p",{className:"text-xs text-green-500 mt-2 flex items-center gap-1",children:[(0,r.jsx)(d.Z,{className:"w-3 h-3"}),"Reward claimed"]})]})]})},t.id)})}),(0,r.jsxs)("div",{className:"bg-elevated border border-white/[0.06] p-6 text-center",children:[(0,r.jsx)("p",{className:"text-muted-foreground text-sm mb-2",children:"Weekly Challenges"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Complete daily challenges to unlock weekly challenges with bigger rewards!"})]})]})}},2869:function(e,t,a){"use strict";a.d(t,{z:function(){return s}});var r=a(7437),i=a(2265),l=a(4508);let s=i.forwardRef((e,t)=>{let{className:a,variant:i="default",size:s="default",isLoading:n=!1,children:c,...d}=e;return(0,r.jsx)("button",{className:(0,l.cn)("inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm font-medium uppercase tracking-wider transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-accent disabled:pointer-events-none disabled:opacity-50",{default:"bg-accent-dim border border-accent-border text-accent hover:bg-accent/20 hover:border-accent",primary:"bg-accent text-background hover:bg-accent/90 border border-accent",secondary:"bg-elevated border border-white/[0.08] text-primary hover:bg-raised hover:border-white/[0.12]",ghost:"hover:bg-elevated hover:text-primary text-muted-foreground",danger:"bg-danger/10 border border-danger/30 text-danger hover:bg-danger/20 hover:border-danger/50",outline:"border border-white/[0.08] bg-transparent hover:bg-elevated hover:text-primary"}[i],{default:"h-9 px-4 py-2",sm:"h-8 px-3 text-xs",lg:"h-11 px-8 text-base",icon:"h-9 w-9"}[s],n&&"opacity-70 cursor-wait",a),ref:t,disabled:d.disabled||n,...d,children:n?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Loading..."]}):c})});s.displayName="Button"},6895:function(e,t,a){"use strict";a.d(t,{v:function(){return s}});var r=a(5978),i=a(4257);let l="users",s={getUserStats:async e=>{let t=await (0,i.xI)();if(!t)return{totalScore:0,gamesPlayed:0,totalPlayTime:0,achievementsUnlocked:0,coins:0,level:1,xp:0,lastPlayed:new Date};let a=(0,r.JU)(t,l,e),s=await (0,r.QT)(a);if(s.exists()){var n;let e=s.data();return{totalScore:e.totalScore||0,gamesPlayed:e.gamesPlayed||0,totalPlayTime:e.totalPlayTime||0,achievementsUnlocked:e.achievementsUnlocked||0,coins:e.coins||0,level:e.level||1,xp:e.xp||0,lastPlayed:(null===(n=e.lastPlayed)||void 0===n?void 0:n.toDate())||new Date}}let c={totalScore:0,gamesPlayed:0,totalPlayTime:0,achievementsUnlocked:0,coins:0,level:1,xp:0,lastPlayed:new Date};return await (0,r.pl)(a,{...c,createdAt:(0,r.Bt)(),updatedAt:(0,r.Bt)()}),c},updateAfterGame:async(e,t,a)=>{let n=await (0,i.xI)();if(!n)return;let c=(0,r.JU)(n,l,e);await (0,r.r7)(c,{totalScore:(0,r.nP)(t),gamesPlayed:(0,r.nP)(1),totalPlayTime:(0,r.nP)(a),xp:(0,r.nP)(Math.max(1,Math.floor(t/100))),lastPlayed:(0,r.Bt)(),updatedAt:(0,r.Bt)()}),await s.checkLevelUp(e)},checkLevelUp:async e=>{let t=await (0,i.xI)();if(!t)return;let a=(0,r.JU)(t,l,e),s=await (0,r.QT)(a);if(!s.exists())return;let n=s.data(),c=n.level||1,d=n.xp||0,o=100*c;if(d>=o){let e=c+1;await (0,r.r7)(a,{level:e,xp:d-o,coins:(0,r.nP)(50*e),updatedAt:(0,r.Bt)()})}},addCoins:async(e,t)=>{let a=await (0,i.xI)();if(!a)return;let s=(0,r.JU)(a,l,e);await (0,r.r7)(s,{coins:(0,r.nP)(t),updatedAt:(0,r.Bt)()})},spendCoins:async(e,t)=>{let a=await (0,i.xI)();if(!a)return!1;let s=(0,r.JU)(a,l,e),n=await (0,r.QT)(s);return!!n.exists()&&!((n.data().coins||0)<t)&&(await (0,r.r7)(s,{coins:(0,r.nP)(-t),updatedAt:(0,r.Bt)()}),!0)},incrementAchievements:async e=>{let t=await (0,i.xI)();if(!t)return;let a=(0,r.JU)(t,l,e);await (0,r.r7)(a,{achievementsUnlocked:(0,r.nP)(1),updatedAt:(0,r.Bt)()})}}},5302:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(9763).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},1723:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(9763).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},8896:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(9763).Z)("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]])},9474:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(9763).Z)("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]])},1239:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(9763).Z)("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]])}},function(e){e.O(0,[358,533,24,30,971,117,744],function(){return e(e.s=4334)}),_N_E=e.O()}]);