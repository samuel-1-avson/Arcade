<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Play Breakout - Break all the bricks! Features Story Mode, Achievements, and more!">
    <title>Breakout | Arcade Hub</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" href="breakout.css">
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect x='10' y='10' width='80' height='30' fill='%23ff4d00'/><rect x='10' y='50' width='80' height='10' fill='%2300ff88'/></svg>">
</head>
<body>
    <div class="game-wrapper breakout-game">
        <!-- Left Sidebar -->
        <aside class="game-sidebar sidebar-left">
            <div class="sidebar-section">
                <h3 class="sidebar-title">Player Stats</h3>
                <div class="stat-row">
                    <span class="stat-label">Level</span>
                    <span class="stat-value" id="player-level">1</span>
                </div>
                <div class="xp-bar">
                    <div class="xp-fill" id="xp-fill" style="width: 0%"></div>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Prestige</span>
                    <span class="stat-value" id="prestige-level">—</span>
                </div>
            </div>
            
            <div class="sidebar-section">
                <h3 class="sidebar-title">Active Power-ups</h3>
                <div class="powerup-list" id="active-powerups">
                    <div class="empty-state">None active</div>
                </div>
            </div>
            
            <div class="sidebar-section">
                <h3 class="sidebar-title">Combo</h3>
                <div class="combo-display" id="combo-display">
                    <span class="combo-value">0</span>
                    <span class="combo-label">hits</span>
                </div>
            </div>
        </aside>

        <!-- Main Game Area -->
        <main class="game-main">
            <header class="game-header">
                <div class="game-header-left">
                    <button id="breakout-back-btn" class="back-btn">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
                        <span>Back</span>
                    </button>
                    <h1 class="game-title">Breakout</h1>
                    <span class="game-mode-badge" id="mode-badge">Classic</span>
                </div>
                
                <div class="game-header-center">
                    <div class="score-display">
                        <div class="score-label">Score</div>
                        <div class="score-value">0</div>
                    </div>
                    <div class="highscore-display">
                        <div class="highscore-label">Best</div>
                        <div class="highscore-value">0</div>
                    </div>
                    <div class="lives-display">
                        <div class="lives-label">Lives</div>
                        <div class="lives-value">3</div>
                    </div>
                </div>
                
                <div class="game-header-right">
                    <button class="icon-btn" id="pause-btn" title="Pause">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                    </button>
                    <button class="icon-btn" id="restart-btn" title="Restart">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
                    </button>
                </div>
            </header>

            <div class="game-container">
                <div class="canvas-wrapper breakout-canvas">
                    <canvas id="game-canvas" width="800" height="600"></canvas>
                    
                    <div class="game-overlay" id="game-overlay">
                        <h2 class="overlay-title">Breakout</h2>
                        <p class="overlay-subtitle">Retro Edition</p>
                        
                        <div class="mode-buttons">
                            <button class="btn btn-primary btn-large" id="start-btn">Start Game</button>
                            <button class="btn btn-secondary" id="maps-btn">Select Map</button>
                            <button class="btn btn-secondary" id="story-btn">Story Mode</button>
                            <button class="btn btn-secondary" id="mode-btn">Game Modes</button>
                        </div>
                        
                        <div class="menu-buttons">
                            <button class="btn btn-ghost" id="multiplayer-btn">Multiplayer</button>
                            <button class="btn btn-ghost" id="leaderboard-btn">Leaderboard</button>
                            <button class="btn btn-ghost" id="achievements-btn">Achievements</button>
                        </div>
                    </div>
                </div>
                
                <div class="controls-hint">
                    <div class="control-key">
                        <span class="key">←</span><span class="key">→</span>
                        <span>Move</span>
                    </div>
                    <div class="control-key">
                        <span class="key">Space</span>
                        <span>Launch</span>
                    </div>
                    <div class="control-key">
                        <span class="key">Mouse</span>
                        <span>Aim</span>
                    </div>
                </div>
            </div>
        </main>

        <!-- Right Sidebar -->
        <aside class="game-sidebar sidebar-right">
            <div class="sidebar-section">
                <h3 class="sidebar-title">Daily Challenges</h3>
                <div class="challenge-list" id="daily-challenges">
                    <div class="challenge-item">
                        <span class="challenge-desc">Loading challenges...</span>
                        <div class="challenge-progress">
                            <div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-section">
                <h3 class="sidebar-title">Weekly Challenge</h3>
                <div class="challenge-item" id="weekly-challenge">
                    <span class="challenge-desc">Loading...</span>
                    <div class="challenge-progress">
                        <div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-section">
                <h3 class="sidebar-title">Recent Achievements</h3>
                <div class="achievement-list" id="recent-achievements">
                    <div class="empty-state">Play to unlock achievements</div>
                </div>
            </div>
        </aside>
    </div>

    <script type="module" src="../../js/utils/GameBridge.js"></script>
    <script type="module" src="Breakout.js"></script>
    <script type="module">
        // Update sidebar displays
        import { AchievementSystem, ACHIEVEMENTS } from './AchievementSystem.js';
        
        function updateSidebars() {
            if (!window.game) return;
            
            const achieveSystem = window.game.achievementSystem;
            if (!achieveSystem) return;
            
            // Update player stats
            const progress = achieveSystem.getProgressDisplay();
            
            document.getElementById('player-level').textContent = progress.level;
            document.getElementById('xp-fill').style.width = `${(progress.xp / progress.xpNeeded) * 100}%`;
            
            if (progress.prestigeLevel > 0 && progress.prestigeInfo) {
                document.getElementById('prestige-level').textContent = progress.prestigeInfo.name;
            }
            
            // Update mode badge
            const modeNames = {
                'CLASSIC': 'Classic',
                'STORY': 'Story',
                'TIME_ATTACK': 'Time Attack',
                'ZEN': 'Zen',
                'ENDLESS': 'Endless',
                'PUZZLE': 'Puzzle'
            };
            document.getElementById('mode-badge').textContent = modeNames[window.game.gameMode] || window.game.gameMode;
            
            // Update daily challenges
            const dailyContainer = document.getElementById('daily-challenges');
            if (progress.dailyChallenges) {
                dailyContainer.innerHTML = progress.dailyChallenges.map(c => `
                    <div class="challenge-item ${c.completed ? 'completed' : ''}">
                        <span class="challenge-desc">${c.desc}</span>
                        <div class="challenge-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${Math.min(100, (c.progress / c.target) * 100)}%"></div>
                            </div>
                            <span class="progress-text">${c.progress}/${c.target}</span>
                        </div>
                    </div>
                `).join('');
            }
            
            // Update weekly challenge
            const weeklyContainer = document.getElementById('weekly-challenge');
            if (progress.weeklyChallenge) {
                const w = progress.weeklyChallenge;
                weeklyContainer.innerHTML = `
                    <span class="challenge-name">${w.name}</span>
                    <span class="challenge-desc">${w.desc}</span>
                    <div class="challenge-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${Math.min(100, (w.progress / w.target) * 100)}%"></div>
                        </div>
                        <span class="progress-text">${w.progress}/${w.target}</span>
                    </div>
                `;
            }
            
            // Update combo display
            const comboDisplay = document.getElementById('combo-display');
            if (window.game.combo > 0) {
                comboDisplay.innerHTML = `
                    <span class="combo-value">${window.game.combo}</span>
                    <span class="combo-label">hits</span>
                `;
                comboDisplay.classList.add('active');
            } else {
                comboDisplay.innerHTML = `
                    <span class="combo-value">0</span>
                    <span class="combo-label">hits</span>
                `;
                comboDisplay.classList.remove('active');
            }
            
            // Update active power-ups
            const powerupList = document.getElementById('active-powerups');
            const activePowerups = window.game.powerupManager?.getActivePowerupsDisplay() || [];
            if (activePowerups.length > 0) {
                powerupList.innerHTML = activePowerups.map(p => `
                    <div class="powerup-item">
                        <span class="powerup-icon">${p.symbol}</span>
                        <div style="flex:1">
                            <span class="powerup-name">${p.name}</span>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${Math.min(100, (p.remaining / 10) * 100)}%"></div>
                            </div>
                        </div>
                    </div>
                `).join('');
            } else {
                powerupList.innerHTML = '<div class="empty-state">No Active Protocols</div>';
            }
        }
        
        // Update every 200ms
        setInterval(updateSidebars, 200);
        
        // Initial update after game loads
        setTimeout(updateSidebars, 1000);
    </script>
    <!-- Arcade Hub Integration -->
    <script src="/games/game-bridge.js"></script>
    <script>
        if (window.ArcadeHub) {
            ArcadeHub.notifyReady();
        }
    </script>
</body>
</html>
